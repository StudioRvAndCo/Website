---
import { Icon } from "astro-icon/components"
import Translations from "@assets/json/translations.json"

const locale = Astro.currentLocale ?? "fr"
const translation = Translations[locale as keyof typeof Translations]
---

<section id="toast" class="hidden">
    <a href="https://twitch.tv/studiorvandco">
        <p><i class="on-air"></i>{translation.onAir}</p>
        <p id="stream-title"></p>
    </a>
    <span>
        <Icon name={"mdi:close"} />
    </span>
</section>

<script>
    import type { TwitchLivestream } from "@types"

    const toast = document.querySelector("#toast")
    const closeBtn = toast?.querySelector("span")
    const streamTitle = document.querySelector("#stream-title")

    document.addEventListener("twitch", (event: any) => {
        const livestreamData = event.detail as TwitchLivestream
        streamTitle!.textContent = livestreamData.title
        toast?.classList.remove("hidden")
    })

    closeBtn?.addEventListener("click", () => {
        toast?.classList.add("hidden")
    })
</script>

<style lang="scss">
    #toast {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        background-color: var(--bg-color);
        color: var(--primary-text);
        border-radius: 8px;
        box-shadow: rgba(0, 0, 0, 0.1) 0 4px 6px -1px, rgba(0, 0, 0, 0.06) 0 2px 4px -1px;
        z-index: 1000;
        display: grid;
        grid-template-columns: 1fr max-content;
        align-items: center;
        transition: opacity 0.3s, transform 0.3s, visibility 0.3s;

        @media (max-width: 660px) {
            left: 1rem;

            a p:last-child {
                width: calc(100vw - 8rem);
            }
        }

        a {
            padding: 0.75rem 0 0.75rem 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            transition: color 200ms;
            text-decoration: none;
            color: var(--subtext-color);

            &:hover {
                color: var(--text-color);
            }

            p:first-child {
                font-weight: 700;
                padding-left: 20px;
                position: relative;

                i {
                    &::before,
                    &::after {
                        content: "";
                        position: absolute;
                        top: 6px;
                        left: 0;
                        width: 12px;
                        height: 12px;
                        border-radius: 50%;
                        background-color: var(--btn-color);
                    }

                    &::after {
                        animation: pulse-scale 2.6s infinite;
                    }

                    @keyframes pulse-scale {
                        0% {
                            opacity: 0.7;
                            transform: scale(1);
                        }
                        100% {
                            opacity: 0;
                            transform: scale(2.4);
                        }
                    }
                }
            }

            p:last-child {
                font-size: 0.92em;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 350px;
            }
        }

        span {
            padding: 1.5rem;
            cursor: pointer;
        }

        &.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transform: translateY(20px);
        }
    }
</style>
