---
import Translations from "@assets/json/translations.json"
import type { YouTubeStatistics } from "@types"

export const prerender = false

const statistics = await Astro.locals.runtime.env.STORE.get("YOUTUBE_STATISTICS", "json") as YouTubeStatistics ?? { viewCount: 0, subscriberCount: 0 }
const locale = Astro.currentLocale ?? "fr"
const translation = Translations[locale as keyof typeof Translations].teaser
---

<p id="nb-views-value" class="hidden">{statistics.viewCount}</p>
<p id="nb-subscribers-value" class="hidden">{statistics.subscriberCount}</p>

<p><span id="nb-views">0</span> {translation.views}</p>
<p><span id="nb-subscribers">0</span> {translation.subscribers}</p>

<script>
    import { CountUp, type CountUpOptions } from "countup.js"

    const nbViewsElement = document.getElementById("nb-views-value")!
    const nbSubscribersElement = document.getElementById("nb-subscribers-value")!

    const countUpOptions: CountUpOptions = {
        duration: 3,
        enableScrollSpy: true,
        scrollSpyOnce: true,
        separator: ' ',
        startVal: 0
    }

    new CountUp("nb-views", Number(nbViewsElement.innerText), countUpOptions)
    new CountUp("nb-subscribers", Number(nbSubscribersElement.innerText), countUpOptions)

    nbViewsElement.remove()
    nbSubscribersElement.remove()
</script>

<style>
    .hidden {
        display: none;
    }

    p {
        width: inherit;
        padding: 0.8rem;
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2em;
        gap: 8px;

        &::after {
            content: "";
            position: absolute;
            left: 2.2em;
            right: 2.2em;
            bottom: -1%;
            height: 2px;
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.15);
        }

        &:last-of-type::after {
            content: none;
        }

        span {
            padding-bottom: 2px;
            font-size: 1.3em;
            font-weight: 700;
        }

        @media (max-width: 950px) {
            padding: 0;
            width: auto;

            &::after {
                content: unset;
            }
        }
    }
</style>
