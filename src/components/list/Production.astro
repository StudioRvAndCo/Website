---
import type { Production } from '@types'
import Translations from '@assets/json/translations.json'

const locale = Astro.currentLocale ?? 'fr'
const translations = Translations[locale as keyof typeof Translations].productions
const { production, index } = Astro.props as { production: Production, index: number }
const productionThumbnails = import.meta.glob('@assets/img/productions/*.webp', { eager: true, import: 'default' })
const thumbnail = Object.values(productionThumbnails)
    .find((image: any) => image.src.includes(production.picture)) as ImageMetadata
---

<style lang="scss">
    .reverse {
        flex-direction: row-reverse;
    }

    section {
        display: flex;
        flex-flow: row nowrap;
        align-items: center;
        gap: 4rem;
        margin-bottom: 4rem;

        &:first-of-type {
            h3 {
                display: inline-flex;
                align-items: center;
                gap: 1rem;

                span {
                    display: inline-block;
                    background-color: var(--projects-bg-color);
                    border-radius: var(--border-radius);
                    padding: 0.4rem 0.6rem;
                    font-size: 0.9em;
                    font-weight: 600;
                    box-shadow: rgb(0 0 0 / 0%) 0 0 0 0, rgb(0 0 0 / 0%) 0 0 0 0,
                    rgb(0 0 0 / 10%) 0 4px 6px -1px, rgb(0 0 0 / 6%) 0 2px 4px -1px;
                }
            }

            img {
                max-height: 320px;
                height: 100%;
                max-width: 569px;
                width: 100%;
                aspect-ratio: 16/9;
            }
        }

        &:last-of-type {
            margin-bottom: 0;
        }

        img {
            height: 100%;
            max-height: 260px;
            width: 100%;
            max-width: 462px;
            border-radius: var(--border-radius);
            @include box-shadow;
        }

        div {
            display: flex;
            flex-flow: column nowrap;
            gap: 1rem;

            h3 {
                font-size: 1.3em;
                font-weight: 600;
            }

            p {
                color: var(--subtext-color);
                margin-bottom: 1rem;
            }
        }

        @media (max-width: 940px) {
            flex-flow: column nowrap !important;
            text-align: center;
            gap: 2rem;
            margin-bottom: calc(var(--spacing) * 1.25);

            h3 {
                justify-content: center;
            }

            .btn {
                margin-inline: auto;
            }
        }
    }
</style>

<section class={index % 2 !== 0 ? 'reverse' : ''}>
    <img src={thumbnail.src} alt={production.name[locale as keyof typeof production.name]} width={thumbnail.width} height={thumbnail.height} loading="lazy" decoding="async" />
    <div>
        <h3>
            {index === 0 && <span>{translations.new}</span>}
            {production.name[locale as keyof typeof production.name]}
        </h3>
        <p>{production.description[locale as keyof typeof production.description]}</p>
        <a href={production.link} class="btn">
            {translations.watch}
        </a>
    </div>
</section>
